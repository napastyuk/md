### Как определить масштаб в браузере?
Сначала хорошенько подумайте нужно ли вам его определять. Обычно механизмы масштаба нужны тогда когда в интерфейсе недостаточный уровень доступности и нужно улучшить читаемость. Но есть случаи когда пользователи привыкли пользоватся внешними механизмами масшаба и нужно подправить интерфейс чтобы он корректно отображался в других режимах.

### Есть 3 механизма масштабирования, которые влияют на размер элементов в браузере.

1. *Масштаб в ОС.*  
В  windows 10 через Параметры->Система->Дисплей->Масштаб и разметка.  Самый простой вариант. Конкретно в браузере меняет только визуальный размер базового шрифта (scale of basic font size).

2. Масштабирование в браузере через изменение размера layout viewport, но без изменения visual viewport.  Этот механизм включается 
		- в десктопных браузерах если крутить колесиком с нажатым Ctrl или выбрать меню-масштаб +/-
		- в мобильных браузерах если включить режим "версия для ПК"
3. Масштабирование в браузере через изменение и размера layout viewport и размера visual viewport. Этот механизм включается
		- в десктопных браузерах, если есть устройство Тачпад. С зажатой клавишей Ctrl делать щипок на тачпаде
		- в мобильных браузерах обычным щипком по экрану

Далее будет подробное объяснение механизма масштабирования
 
### Разные пиксели одного устройства
Итак основные термины:
*Физический пиксель/device pixel* - наименьшая цветовая точка которую может отобразить устройство
*Логический пиксель* - информация определяющая цвет в опеределённом месте сетки. Логический пиксель не имеет размера и определяется на уровне ОС
*CSS пиксель* - по спецификации это точка конкретного размера 1/96 часть дюйма.  
[спека](https://www.w3.org/TR/css-values-4/#px) 

### Когда пиксели стали логическими?
Разница размеров физический/логический пиксель тянется еще с первых ЭВМ когда надо было соотносить размеры точки выведенной на экран и напечатанной точки (напечатанная точка всегда была и сейчас остается сильно меньше размером).  В первую очередь чтобы обеспечить читаемый размер текста на устройствах разного размера были введены размеры:  
- Базовый размер шрифта равен 16 пикселям
- 1 пиксель экрана равен 1/96 дюйма
- 1 печатный пиксель равен 1/72 дюйма
Это были рекомендуемый размеры чтобы обеспечить в первую очередь читаемость текста на устройствах разного размера, в итоге закреплённые в стандарте. Тогда все экраны были ЭЛТ и из за ограничений технологий размер физического пикселя был плюс минут одинаковый (размером 1/96 дюйма). 

Потом появились ЖК экраны и размер отдельной цветовой точки на экране стал уменьшатся. Появились экраны с повышенной плотностью пикселей. Одновременно появились носимые устройства и размер самого экрана стали уменьшать ради портативности.  Но к этому весь софт и особенно сайты ориентировались на *количество* пикселей как на меру *размера* интерфейсов. Ну просто потому что за предыдущие года стандарт 1/96 устоялся и софт писался исходя из него.  Это приводило к тому что у устройств с маленьким размером, но высоким разрешением все сайты и интерфейсы выглядели нечитаемо мелкими.  Решением стало изменения плотности пикселей.

### В чем измеряется плотность пикселей?
*PPI* (Pixels Per Inch) - количество отдельных цветовых точек на один дюйм изображения на мониторе. Эта мера плотности пикселей **экрана**.
*DPI* (Dots Per Inch) - количество отдельных цветовых точек на один дюйм у напечатанного листа. Это мера плотностей пикслей на **печати** . Метрический аналог это *dpcm* (dots per centimeter) 
*DPPX* (Pots Per Pixel) -  измеряет сколько точек экрана помещается в одном CSS пикселе.

### Как измерить плотность пикселей в JS
```js
window.devicePixelRatio; 
```

### Как измерить плотность пикселей в CSS
```css
@media (resolution: 2x) { 
/*устройсво с экраном повышенной плотности*/
}
@media (min-resolution: 2dppx) { 
/*min, max тоже поддерживается*/
/*x это сокращение для dppx*/
}
```
В основном `resolution` измеряют в `dppx`. Но так как CSS это не только визуализация сайтов на экране, но и визуализация напечатанных сайтов `resolution` так же поддерживает единицу измерения `dpi`.  Для экранов она закреплена стандартом в 96 единиц. А вот при формировании версии для печати с помощью `dpi` можно выставлять разные медиазапросы для принтеров с разным размером печатной точки.  
`PPI` относится к характеристикам экрана. Так как CSS не работает с экранными пикселями напрямую, эта единица измерения не используется в web-стандартах.

### Решение для совместимости со старым ПО - разделяем физические и логические пиксели. 
Софт и браузеры теперь оперируют логическими пикселями.  Логический пиксель - координата одной цветовой точки. Допустим у нас есть монитор от десктопа на котором выставленно разрешение 1920x1080 и браузер открыт на весь экран без панелей. В этом случае средствами CSS и JS мы работаем с массивом из 2 073 600 точек сформированных в прямоугольник с пропорцими 16:9.  А ОС уже накладывает эту сетку логических пикселей на физические пиксели экрана. Так что обеспечить максиамльную четкость. И если в ОС выставить другое разрешение то сетка пикселей будет накладватся по другому.


### Решение для совместимости с неадаптивными сайтами - визуальный вьюпорт. 
Далее в браузере телефона понадобилось сделать механизм что бы можно было просмотривать дестопные сайты на телефоне, но не уменьшая сайт целиком, а просматривая сайт по частям как традиционно просматривали карты или большие изображения.  Для этого сначала в Safary, а потом и в другие браузерные движки внесли такую сущность как visual viewport в противовес старому layout viewport.  Если продолжать аналогию с онлайн картами, то layout viewport - это размер всей карты , а visual viewport эта та часть карты, которую пользователь видит на экране.  Механизм управлялся уже ставшим привычным для мобильного устройства свайпом и щипком пальзами.  
*При изменении масштаба браузер теперь изменяет размер именно layout viewport. Это позволяет перерисовывать весь сайт под новый виртутальный экран с нужным размером элементов* 




### Как с CSS определить зум ОС?
Никак. Зум ОС влияет только на физический размер базового шрифта в браузере.

### Как с CSS определить зум браузера?
Только косвено.  Можно повесить слушатель размера через Visual API, но это не поможет если в момент загрузки зум был уже включен. При зуме увеличивается Layout viewport.  Но если дескопные браузеры делают это вкючением эмуляции экранов с другой плотностью
```css
@media (resolution: 0.5x) {
	/*на десктопе это уменьшение сайта в 2 раза*/
}
```
```js
window.matchMedia('(resolution: 0.5x)').matches
//то же
```

То мобильные браузеры могут дополнительно включать режим когда сайт можно просматривать фрагментами (pinch-zooming / масштаб щипком). Это можно отслеить через слушателей [Visual API]https://developer.mozilla.org/en-US/docs/Web/API/Visual_Viewport_API 


