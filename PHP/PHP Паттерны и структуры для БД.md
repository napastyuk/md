#php/db #Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ #Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ñ‹ 

## PDO (PHP Data Objects)
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Ð² PHP ÑÐ¿Ð¾ÑÐ¾Ð± Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð‘Ð” Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð‘Ð”, Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ SQL-Ð¸Ð½ÑŠÐµÐºÑ†Ð¸Ð¹.

```php
$pdo = new PDO('mysql:host=localhost;dbname=test', 'root', '');  //DSN (Data Source Name) ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ðº Ð‘Ð”
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?"); //prepared Statement aka Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ/Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹. ? - ÑÑ‚Ð¾ placeholder. Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ‚ÑƒÐ´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð¾ Ð¿Ð¾Ð·Ð¶Ðµ
$stmt->execute([1]); //Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°. [1] â€” Ð¼Ð°ÑÑÐ¸Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð·Ð°Ð¼ÐµÐ½ÑÐµÑ‚ `?` Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ
$user = $stmt->fetch(PDO::FETCH_ASSOC); //fetch Ð¸Ð·Ð²Ð»ÐµÐºÐ°ÐµÑ‚ Ð¾Ð´Ð½Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¸ PDO::FETCH_ASSOC Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐµÐµ ÐºÐ°Ðº Ð°ÑÑÐ¾Ñ†Ð¸Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼Ð°ÑÑÐ¸Ð², Ð³Ð´Ðµ ÐºÐ»ÑŽÑ‡Ð¸ â€” ÑÑ‚Ð¾ Ð¸Ð¼ÐµÐ½Ð° ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹. 
```

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼Ð¸ id, name, email:
```php
[
  'id' => 1,
  'name' => 'Ð˜Ð»ÑŒÑ',
  'email' => 'ilya@mail.com'
]
```

---

## DTO (Data Transfer Object)
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÐºÐ»Ð°ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ….
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ ÑÐ»Ð¾ÑÐ¼Ð¸ Ð±ÐµÐ· Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ¸.

```php
class UserDTO {
    public function __construct(
        public int $id,
        public string $name
    ) {}
}
```

ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼Ð°ÑÑÐ¸Ð²?
- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð². ÐÐµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐ°/Ñ‡Ð¸ÑÐ»Ð¾, ÐºÐ°Ðº Ñƒ Ð¼Ð°ÑÑÐ¸Ð²Ð°.
- Ð¡Ð°Ð¼Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ. Ð’ÑÐµ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð±ÑƒÐ´ÑƒÑ‚
- Ð§ÐµÑ€ÐµÐ· public/protect ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð±ÑƒÐ´ÐµÑ‚ ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ñ‹Ð¼ Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐ¼Ð¸ ÐºÐ»Ð°ÑÑÐ°Ð¼Ð¸ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ. 

---

## DAO (Data Access Object)
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: ÐºÐ»Ð°ÑÑ, Ð¸Ð½ÐºÐ°Ð¿ÑÑƒÐ»Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¹ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð°Ð±ÑÑ‚Ñ€Ð°Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð‘Ð” Ð¾Ñ‚ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ¸. ÐžÐ¿ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ð´Ð¾Ð¼ÐµÐ½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸. 

```php
class UserDAO {
    public function __construct(private PDO $db) {}

    public function findById(int $id): ?UserDTO {
        $stmt = $this->db->prepare("SELECT * FROM users WHERE id = ?");
        $stmt->execute([$id]);
        $row = $stmt->fetch();
        return $row ? new UserDTO($row['id'], $row['name']) : null;
    }
}
```

---

## TDG (Table Data Gateway)
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ð³Ð´Ðµ Ð¾Ð´Ð¸Ð½ ÐºÐ»Ð°ÑÑ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ð´Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÐµÐ¹ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹. Ð­Ñ‚Ð¾ Ð½Ð¸Ð·ÐºÐ¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ð‘Ð” Ð² Ð²Ð¸Ð´Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ð° Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸Ð¼Ð¸Ñ‚Ð¸Ð²Ð¾Ð²
**ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ:** ÑÑ‚Ð¾ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ð¿Ñ€Ð¸ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ (ÑˆÐ»ÑŽÐ·), ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ CRUD (Create, Read, Update, Delete).

```php
class UserGateway {
    public function __construct(private PDO $db) {}

    public function insert(string $name): void {
        $this->db->prepare("INSERT INTO users (name) VALUES (?)")->execute([$name]);
    }

    public function findById(int $id): array|false {
        $stmt = $this->db->prepare("SELECT * FROM users WHERE id = ?");
        $stmt->execute([$id]);
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }
}
```

---

## RDG (Row Data Gateway)
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð¼ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ð´Ð½Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ñ Ð¼ÐµÑ‚Ð¾Ð´Ð°Ð¼Ð¸ `save()`, `delete()` Ð¸ Ñ‚.Ð´.
**Ð—Ð°Ñ‡ÐµÐ¼**: ÑƒÐ´Ð¾Ð±Ð½Ð°Ñ Ð¾Ð±ÐµÑ€Ñ‚ÐºÐ° Ð½Ð°Ð´ Ð¾Ð´Ð½Ð¾Ð¹ Ð·Ð°Ð¿Ð¸ÑÑŒÑŽ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ.

```php
class UserRDG {
    public function __construct(
        private PDO $db,
        public int $id,
        public string $name
    ) {}

    public function save(): void {
        $stmt = $this->db->prepare("UPDATE users SET name = ? WHERE id = ?");
        $stmt->execute([$this->name, $this->id]);
    }
}
```

---

## Data Mapper
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ Ð´Ð»Ñ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð¼ Ð¸ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸: Ð¾Ð±ÑŠÐµÐºÑ‚ Ñ‡Ð¸ÑÑ‚Ñ‹Ð¹, SQL â€” Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð½Ð°Ñ Ñ‡Ð¸ÑÑ‚Ð¾Ñ‚Ð°, ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ SRP Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ.
**ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ:** Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ð¿Ñ€Ð¸ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚ (Ð¼Ð°Ð¿Ð¿ÐµÑ€) Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ Ð·Ð° Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸ Ð¸ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑ Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¸ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼. Ð­Ñ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð»ÑƒÑ‡ÑˆÑƒÑŽ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð´Ð°, Ð½Ð¾ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð¸ Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ðµ Ð¼Ð°Ð¿Ð¿ÐµÑ€ Ð¼ÐµÐ¶Ð´Ñƒ Ð±Ð¸Ð·Ð½ÐµÑ-ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð¸ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð¸Ð· Ð‘Ð”

```php
class User {
    public function __construct(public int $id, public string $name) {}
}

class UserMapper {
    public function __construct(private PDO $db) {}

    public function findById(int $id): ?User {
        $stmt = $this->db->prepare("SELECT * FROM users WHERE id = ?");
        $stmt->execute([$id]);
        $row = $stmt->fetch();
        return $row ? new User($row['id'], $row['name']) : null;
    }

    public function save(User $user): void {
        $stmt = $this->db->prepare("UPDATE users SET name = ? WHERE id = ?");
        $stmt->execute([$user->name, $user->id]);
    }
}
```

---

## Active Record
**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð‘Ð” (`save()`, `delete()`).
**Ð—Ð°Ñ‡ÐµÐ¼**: ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð¾, Ð½Ð¾ Ð½Ð°Ñ€ÑƒÑˆÐ°ÐµÑ‚ SRP.
**ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ:** Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ð¿Ñ€Ð¸ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ ÑÐ¾Ð±Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÑƒ. Ð­Ñ‚Ð¾ ÑƒÐ¿Ñ€Ð¾Ñ‰Ð°ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð½Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸ÑŽ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð° ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸.

```php
class User {
    private static PDO $db;

    public static function setDb(PDO $db): void {
        self::$db = $db;
    }

    public function __construct(
        public ?int $id,
        public string $name
    ) {}

    public function save(): void {
        if ($this->id) {
            $stmt = self::$db->prepare("UPDATE users SET name = ? WHERE id = ?");
            $stmt->execute([$this->name, $this->id]);
        } else {
            $stmt = self::$db->prepare("INSERT INTO users (name) VALUES (?)");
            $stmt->execute([$this->name]);
            $this->id = self::$db->lastInsertId();
        }
    }
}
```

---

## Identity Map

**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, ÐºÑÑˆ Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚ Ñ Ð¾Ð´Ð½Ð¸Ð¼ Ð¸ Ñ‚ÐµÐ¼ Ð¶Ðµ ID ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð¾Ð´Ð½Ð¾Ð¼ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ðµ.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ñ… Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¾Ðº Ð¸Ð· Ð‘Ð” Ð¸ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð².

```php
class IdentityMap {
    private array $entities = [];

    public function get(int $id): ?User {
        return $this->entities[$id] ?? null;
    }

    public function add(User $user): void {
        $this->entities[$user->id] = $user;
    }
}
```

---

## Lazy Load

**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… â€” Ð¾Ð±ÑŠÐµÐºÑ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ "Ð·Ð°Ð³Ð»ÑƒÑˆÐºÑƒ", Ð° Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸.
**Ð—Ð°Ñ‡ÐµÐ¼**: ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² Ð¸ ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð¸Ðµ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸.

```php
class Profile {
    public function __construct(public int $id, public string $bio) {}
}

class User {
    private ?Profile $profile = null;

    public function __construct(
        public int $id,
        public string $name,
        private PDO $db
    ) {}

    public function getProfile(): Profile {
        if (!$this->profile) {
            $stmt = $this->db->prepare("SELECT * FROM profiles WHERE user_id = ?");
            $stmt->execute([$this->id]);
            $row = $stmt->fetch();
            $this->profile = new Profile($row['id'], $row['bio']);
        }
        return $this->profile;
    }
}
```

---

## DAL (Data Access Layer)


**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾**: ÑÐ»Ð¾Ð¹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÑŽÑ‰Ð¸Ð¹ Ð·Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼. ÐœÐ¾Ð¶ÐµÑ‚ Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ DAO, TDG, Mapper Ð¸ Ð´Ñ€.
**Ð—Ð°Ñ‡ÐµÐ¼**: Ð¾Ñ‚Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð¾Ñ‚ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ….

```php
// DAL Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ ÐºÐ°Ðº Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾ Ð¸Ð¼Ñ‘Ð½ Ð¸Ð»Ð¸ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ,
// Ð³Ð´Ðµ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ DAO, Mapper Ð¸ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ»Ð°ÑÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð‘Ð”.
namespace App\DAL;

class UserDAL {
    private UserDAO $dao;

    public function __construct(PDO $db) {
        $this->dao = new UserDAO($db);
    }

    public function getUserName(int $id): ?string {
        $user = $this->dao->findById($id);
        return $user?->name;
    }
}
```

---

## Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ

| ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½/ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ‚                | Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð‘Ð”   | ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…  | Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ð¸                 | ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹                     |
| ------------------------------ | ------------- | --------------------- | ---------------------------------- | ------------------------------- |
| **PDO (PHP Data Objects)**     | Ð”Ð°            | ÐÐµÑ‚                   | ÐÐ¸Ð·ÐºÐ¸Ð¹                             | Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚              |
| **DTO (Data Transfer Object)** | ÐÐµÑ‚           | Ð”Ð°                    | ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼    | Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…          |
| **DAO (Data Access Object)**   | Ð”Ð°            | ÐÐµÑ‚/DTO               | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | ÐÐ±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ñ Ð½Ð°Ð´ SQL              |
| **TDG (Table Data Gateway)**   | Ð”Ð°            | ÐÑÑÐ¾Ñ†. Ð¼Ð°ÑÑÐ¸Ð²         | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | ÐžÐ´Ð¸Ð½ ÐºÐ»Ð°ÑÑ â€” Ð¾Ð´Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°       |
| **RDG (Row Data Gateway)**     | Ð”Ð°            | ÐžÐ±ÑŠÐµÐºÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸         | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | ÐœÐµÑ‚Ð¾Ð´Ñ‹ Ð½Ð°Ð´ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð¹              |
| **Data Mapper**                | Ð”Ð° (Ð¾Ð¿Ð¾ÑÑ€ÐµÐ´.) | Ð§Ð¸ÑÑ‚Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹        | Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | Ð Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð»Ð¾Ð³Ð¸Ðº                |
| **Active Record**              | Ð”Ð°            | ÐžÐ±ÑŠÐµÐºÑ‚ + SQL Ð²Ð½ÑƒÑ‚Ñ€Ð¸   | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | Ð’ÑÑ‘ Ð² Ð¾Ð´Ð½Ð¾Ð¼ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾, Ð½Ð¾ Ð³Ñ€ÑÐ·Ð½Ð¾ |
| **Identity Map**               | ÐÐµÑ‚           | ÐšÑÑˆ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²          | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ | Ð“Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸  |
| **Lazy Load**                  | Ð”Ð° (Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð¾) | Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°    | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ | Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²               |
| **DAL (Data Access Layer)**    | Ð”Ð°            | Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ DAO/Mapper | Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼   | Ð¡Ð»Ð¾Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼           |
| **Repository**                 | ÐÐµÑ‚           | Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ DAO/Mapper | Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð‘Ð¸Ð·Ð½ÐµÑÑ-ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ            | Ð§Ð¸ÑÑ‚Ð°Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ†Ð¸Ñ        |

Ð”Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð° ÐºÑ‚Ð¾ Ñ ÐºÐµÐ¼ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

```mermaid

flowchart TD

subgraph "â†˜ï¸ ÐÐ¸Ð·ÐºÐ¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ñ‹Ðµ"
    PDO(["PDO"])
end

subgraph "ðŸ’¾ Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼"
    DTO(["DTO"])
    TDG(["TDG"])
    RDG(["RDG"])
    DAO(["DAO"])
    Mapper(["Data Mapper"])
    AR(["Active Record"])
    DAL(["DAL"])
end

subgraph "ðŸ” ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°"
    IM(["Identity Map"])
    Lazy(["Lazy Load"])
end

subgraph "ðŸ›ï¸ Ð‘Ð¸Ð·Ð½ÐµÑ-ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ"
    Repo(["Repository"])
end

%% Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ñ‚ PDO
TDG --> PDO
RDG --> PDO
DAO --> PDO
Mapper --> PDO
AR --> PDO

%% DTO Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ñ€ÑÐ´Ð¾Ð¼ Ñ DAO Ð¸ Mapper
DAO --> DTO
Mapper --> DTO

%% DAL Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐµÑ‚ DAO/Mapper
DAL --> DAO
DAL --> Mapper

%% Identity Map Ð¸ Lazy Load Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ AR/Mapper
IM --> Mapper
IM --> AR
Lazy --> Mapper
Lazy --> AR

%% Repository Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ DAL Ð¸Ð»Ð¸ Mapper/DAO Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ
Repo --> DAL
Repo --> Mapper
Repo --> DAO
```


```mermaid

sequenceDiagram
    participant UI as Observer
    participant Repo as Repository
    participant DAL as DAL
    participant IM as Identity Map
    participant Lazy as Lazy Loader
    participant DB as PDO (DB)

    UI->>Repo: findById(1)
    Repo->>DAL: findById(1)
    DAL->>IM: get(1)
    IM-->>DAL: not found
    DAL->>DB: SELECT * FROM users WHERE id = 1
    DB-->>DAL: user row
    DAL->>IM: add(1, user)
    DAL-->>Repo: User object (Ð±ÐµÐ· profile)
    Repo-->>UI: user

    UI->>Repo: user->getProfile()
    Repo->>Lazy: get(2)
    Lazy->>IM: get(2)
    IM-->>Lazy: not found
    Lazy->>DB: SELECT * FROM profiles WHERE user_id = 1
    DB-->>Lazy: profile row
    Lazy->>IM: add(2, profile)
    Lazy-->>Repo: profile
    Repo-->>UI: profile

```